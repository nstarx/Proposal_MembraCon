<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MembraCon WaterLogic - RO System Configurator</title>

  <!-- Google Material Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons|Material+Icons+Outlined|Material+Icons+Round" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    /* CSS Variables */
    :root {
      --bg: #0a0f1a;
      --panel: #0d1424;
      --card: #111b2e;
      --card-hover: #162035;
      --muted: #8fa3c0;
      --text: #e8f0ff;
      --line: #1e2d4a;
      --accent: #6366f1;
      --accent2: #22d3ee;
      --accent3: #a855f7;
      --success: #22c55e;
      --warning: #f59e0b;
      --danger: #ef4444;
      --esg-green: #10b981;
      --esg-blue: #3b82f6;
      --input-bg: rgba(0,0,0,0.2);
    }

    [data-theme="light"] {
      --bg: #f5f7fa;
      --panel: #ffffff;
      --card: #ffffff;
      --card-hover: #f8fafc;
      --muted: #64748b;
      --text: #1e293b;
      --line: #e2e8f0;
      --accent: #4f46e5;
      --accent2: #0891b2;
      --success: #16a34a;
      --warning: #d97706;
      --danger: #dc2626;
      --input-bg: #f1f5f9;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Inter', -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      transition: background-color 0.2s, color 0.2s;
    }

    /* Header */
    .app-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 56px;
      background: var(--panel);
      border-bottom: 1px solid var(--line);
      display: flex;
      align-items: center;
      padding: 0 20px;
      z-index: 1000;
      gap: 16px;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-icon {
      width: 36px;
      height: 36px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      color: #fff;
    }

    .logo-text {
      font-size: 18px;
      font-weight: 700;
    }

    .logo-text span { color: var(--accent2); }

    .header-spacer { flex: 1; }

    .theme-toggle {
      width: 36px;
      height: 36px;
      border-radius: 8px;
      background: var(--card);
      border: 1px solid var(--line);
      color: var(--muted);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .theme-toggle:hover {
      background: var(--card-hover);
      color: var(--text);
    }

    /* Main Layout */
    .app-container {
      margin-top: 56px;
      display: flex;
      min-height: calc(100vh - 56px);
    }

    /* Sidebar */
    .sidebar {
      width: 300px;
      background: var(--panel);
      border-right: 1px solid var(--line);
      padding: 20px;
      overflow-y: auto;
    }

    .sidebar-section {
      background: var(--card);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
      border: 1px solid var(--line);
    }

    .sidebar-title {
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--muted);
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .form-group {
      margin-bottom: 14px;
    }

    .form-label {
      display: block;
      font-size: 11px;
      font-weight: 600;
      color: var(--muted);
      margin-bottom: 5px;
    }

    .form-input {
      width: 100%;
      padding: 8px 12px;
      background: var(--input-bg);
      border: 1px solid var(--line);
      border-radius: 8px;
      color: var(--text);
      font-size: 13px;
    }

    .form-input:focus {
      outline: none;
      border-color: var(--accent);
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    .form-row.three-cols {
      grid-template-columns: 1fr 1fr 1fr;
    }

    /* Main Content */
    .main-content {
      flex: 1;
      padding: 24px;
      overflow-y: auto;
    }

    .page-title {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .page-subtitle {
      font-size: 14px;
      color: var(--muted);
      margin-bottom: 24px;
    }

    /* Metrics Grid */
    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 16px;
      margin-bottom: 24px;
    }

    .metric-card {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 16px;
    }

    .metric-label {
      font-size: 10px;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 6px;
    }

    .metric-value {
      font-size: 24px;
      font-weight: 700;
    }

    .metric-value.accent { color: var(--accent); }
    .metric-value.success { color: var(--success); }
    .metric-value.warning { color: var(--warning); }
    .metric-value.accent2 { color: var(--accent2); }
    .metric-value.danger { color: var(--danger); }

    .metric-sub {
      font-size: 11px;
      color: var(--muted);
      margin-top: 4px;
    }

    /* Content Panels */
    .content-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .content-panel {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 20px;
    }

    .content-panel.full-width {
      grid-column: 1 / -1;
    }

    .panel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .panel-title {
      font-size: 14px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .panel-title .material-icons-outlined {
      font-size: 20px;
      color: var(--accent);
    }

    .panel-badge {
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 600;
      background: rgba(99,102,241,0.15);
      color: var(--accent);
    }

    /* System Model Selection */
    .model-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
    }

    .model-card {
      padding: 12px;
      background: var(--input-bg);
      border: 2px solid var(--line);
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.15s ease;
      text-align: center;
    }

    .model-card:hover {
      border-color: var(--accent);
      background: rgba(99,102,241,0.05);
    }

    .model-card.selected {
      border-color: var(--accent);
      background: rgba(99,102,241,0.1);
    }

    .model-card.recommended {
      position: relative;
    }

    .model-card.recommended::before {
      content: 'Best Match';
      position: absolute;
      top: -8px;
      left: 50%;
      transform: translateX(-50%);
      padding: 2px 8px;
      background: var(--success);
      color: #000;
      font-size: 9px;
      font-weight: 700;
      border-radius: 4px;
      text-transform: uppercase;
    }

    .model-name {
      font-size: 14px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .model-flow {
      font-size: 12px;
      color: var(--accent2);
      font-weight: 600;
    }

    .model-price {
      font-size: 11px;
      color: var(--muted);
      margin-top: 4px;
    }

    /* Warnings/Alarms */
    .alarm-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .alarm-item {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      padding: 12px;
      border-radius: 8px;
      font-size: 12px;
    }

    .alarm-item.critical {
      background: rgba(239,68,68,0.1);
      border: 1px solid rgba(239,68,68,0.3);
      color: var(--danger);
    }

    .alarm-item.warning {
      background: rgba(245,158,11,0.1);
      border: 1px solid rgba(245,158,11,0.3);
      color: var(--warning);
    }

    .alarm-item.info {
      background: rgba(34,211,238,0.1);
      border: 1px solid rgba(34,211,238,0.3);
      color: var(--accent2);
    }

    .alarm-item.success {
      background: rgba(34,197,94,0.1);
      border: 1px solid rgba(34,197,94,0.3);
      color: var(--success);
    }

    .alarm-item .material-icons-outlined {
      font-size: 18px;
    }

    /* Component List */
    .component-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .component-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 12px;
      background: var(--input-bg);
      border-radius: 8px;
      font-size: 13px;
    }

    .component-item.auto {
      border-left: 3px solid var(--warning);
    }

    .component-item.manual {
      border-left: 3px solid var(--accent);
    }

    .component-name {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .component-tag {
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 9px;
      font-weight: 600;
      text-transform: uppercase;
    }

    .component-tag.auto {
      background: rgba(245,158,11,0.2);
      color: var(--warning);
    }

    .component-tag.required {
      background: rgba(239,68,68,0.2);
      color: var(--danger);
    }

    .component-price {
      font-weight: 600;
      color: var(--accent2);
    }

    /* Pricing Summary */
    .pricing-table {
      width: 100%;
      border-collapse: collapse;
    }

    .pricing-table th,
    .pricing-table td {
      padding: 10px 12px;
      text-align: left;
      border-bottom: 1px solid var(--line);
      font-size: 13px;
    }

    .pricing-table th {
      font-size: 11px;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      background: var(--input-bg);
    }

    .pricing-table tr.total {
      font-weight: 700;
      background: rgba(99,102,241,0.05);
    }

    .pricing-table tr.total td {
      border-bottom: none;
      padding-top: 14px;
      padding-bottom: 14px;
    }

    /* ROI Section */
    .roi-grid {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 16px;
    }

    .roi-card {
      text-align: center;
      padding: 20px;
      background: var(--input-bg);
      border-radius: 10px;
      border: 1px solid var(--line);
    }

    .roi-value {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .roi-label {
      font-size: 12px;
      color: var(--muted);
    }

    /* Buttons */
    .btn {
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: all 0.15s ease;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent), #818cf8);
      color: #fff;
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 16px rgba(99,102,241,0.4);
    }

    .btn-secondary {
      background: var(--input-bg);
      border: 1px solid var(--line);
      color: var(--text);
    }

    .btn-success {
      background: linear-gradient(135deg, var(--success), #16a34a);
      color: #fff;
    }

    .action-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 24px;
      padding-top: 20px;
      border-top: 1px solid var(--line);
    }

    /* Chips */
    .chip-group {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .chip {
      padding: 6px 12px;
      border-radius: 6px;
      background: var(--input-bg);
      border: 1px solid var(--line);
      font-size: 11px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.15s ease;
    }

    .chip:hover {
      border-color: var(--accent);
    }

    .chip.active {
      background: rgba(99,102,241,0.15);
      border-color: var(--accent);
      color: var(--accent);
    }

    /* Calculations Panel */
    .calc-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      font-size: 12px;
    }

    .calc-item {
      display: flex;
      justify-content: space-between;
      padding: 6px 0;
      border-bottom: 1px solid var(--line);
    }

    .calc-label {
      color: var(--muted);
    }

    .calc-value {
      font-weight: 600;
      color: var(--accent2);
    }

    /* Responsive */
    @media (max-width: 1400px) {
      .metrics-grid { grid-template-columns: repeat(3, 1fr); }
      .model-grid { grid-template-columns: repeat(3, 1fr); }
    }

    @media (max-width: 1200px) {
      .content-grid { grid-template-columns: 1fr; }
      .sidebar { width: 280px; }
    }
  </style>
</head>
<body data-theme="light">
  <!-- Header -->
  <header class="app-header">
    <div class="logo">
      <div class="logo-icon">
        <span class="material-icons-round">water_drop</span>
      </div>
      <div class="logo-text">MembraCon <span>WaterLogic</span></div>
    </div>
    <div class="header-spacer"></div>
    <button class="theme-toggle" onclick="toggleTheme()">
      <span class="material-icons-outlined" id="themeIcon">dark_mode</span>
    </button>
    <span style="font-size:12px;color:var(--muted)">RO Configurator v2.0</span>
  </header>

  <div class="app-container">
    <!-- Sidebar: Input Parameters -->
    <aside class="sidebar">
      <div class="sidebar-section">
        <div class="sidebar-title">
          <span class="material-icons-outlined" style="font-size:16px">business</span>
          Target Market
        </div>
        <select class="form-input" id="targetMarket" onchange="recalculate()" style="font-size:12px">
          <option value="waterUtilities">Water Utilities</option>
          <option value="industrial">Industrial Manufacturing</option>
          <option value="automotive">Automotive</option>
          <option value="foodBeverage" selected>Food & Beverage</option>
          <option value="adPlants">Anaerobic Digestate (AD) Plants</option>
        </select>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">
          <span class="material-icons-outlined" style="font-size:16px">water_drop</span>
          System Requirements
        </div>

        <div class="form-group">
          <label class="form-label">Required Permeate Flow (m³/hr)</label>
          <select class="form-input" id="permeateFlow" onchange="recalculate()">
            <option value="0.25">0.25 m³/hr</option>
            <option value="0.5">0.5 m³/hr</option>
            <option value="1">1 m³/hr</option>
            <option value="1.5">1.5 m³/hr</option>
            <option value="2">2 m³/hr</option>
            <option value="3">3 m³/hr</option>
            <option value="4">4 m³/hr</option>
            <option value="6">6 m³/hr</option>
            <option value="9" selected>9 m³/hr</option>
            <option value="12">12 m³/hr</option>
            <option value="16">16 m³/hr</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">Permeate Quality Target (µS/cm)</label>
          <input type="number" class="form-input" id="permeateQuality" value="12" onchange="recalculate()">
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Recovery (%)</label>
            <input type="number" class="form-input" id="recovery" value="75" min="50" max="95" onchange="recalculate()">
          </div>
          <div class="form-group">
            <label class="form-label">Markup (%)</label>
            <input type="number" class="form-input" id="markup" value="30" min="0" max="100" onchange="recalculate()">
          </div>
        </div>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">
          <span class="material-icons-outlined" style="font-size:16px">science</span>
          Feed Water Quality
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Conductivity (µS/cm)</label>
            <input type="number" class="form-input" id="feedConductivity" value="500" onchange="recalculate()">
          </div>
          <div class="form-group">
            <label class="form-label">TDS (ppm)</label>
            <input type="number" class="form-input" id="feedTDS" value="350" onchange="recalculate()">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Feed Pressure (BAR)</label>
            <input type="number" class="form-input" id="feedPressure" value="4" step="0.5" onchange="recalculate()">
          </div>
          <div class="form-group">
            <label class="form-label">Temperature (°C)</label>
            <input type="number" class="form-input" id="feedTemp" value="15" onchange="recalculate()">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label">TSS (ppm)</label>
            <input type="number" class="form-input" id="feedTSS" value="1" onchange="recalculate()">
          </div>
          <div class="form-group">
            <label class="form-label">Turbidity (NTU)</label>
            <input type="number" class="form-input" id="feedTurbidity" value="1" onchange="recalculate()">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Chlorine (ppm)</label>
            <input type="number" class="form-input" id="feedChlorine" value="0.01" step="0.01" onchange="recalculate()">
          </div>
          <div class="form-group">
            <label class="form-label">SDI</label>
            <input type="number" class="form-input" id="feedSDI" value="3" step="0.5" onchange="recalculate()">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label">pH</label>
            <input type="number" class="form-input" id="feedPH" value="7" step="0.1" min="1" max="14" onchange="recalculate()">
          </div>
          <div class="form-group">
            <label class="form-label">Iron (mg/L)</label>
            <input type="number" class="form-input" id="feedIron" value="0.01" step="0.01" onchange="recalculate()">
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Hardness (mg/L CaCO₃)</label>
          <input type="number" class="form-input" id="feedHardness" value="100" onchange="recalculate()">
        </div>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">
          <span class="material-icons-outlined" style="font-size:16px">settings</span>
          Options
        </div>
        <div class="chip-group">
          <div class="chip" id="chipContainer" onclick="toggleChip(this)">Container</div>
          <div class="chip" id="chipUV" onclick="toggleChip(this)">UV System</div>
          <div class="chip active" id="chipCIP" onclick="toggleChip(this)">CIP System</div>
          <div class="chip" id="chipMonitoring" onclick="toggleChip(this)">Remote Monitoring</div>
        </div>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">
          <span class="material-icons-outlined" style="font-size:16px">handshake</span>
          Technology Partners
        </div>
        <div class="chip-group">
          <div class="chip" id="chipNXFiltration" onclick="toggleChip(this)" style="border-color:rgba(0,160,220,0.5);color:#00a0dc">NX Filtration</div>
          <div class="chip" id="chipAtlantiumUV" onclick="toggleChip(this)" style="border-color:rgba(247,147,30,0.5);color:#f7931e">Atlantium UV</div>
          <div class="chip" id="chipBNovate" onclick="toggleChip(this)" style="border-color:rgba(0,178,122,0.5);color:#00b27a">bNovate Monitoring</div>
        </div>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">
          <span class="material-icons-outlined" style="font-size:16px">precision_manufacturing</span>
          Fabrication
        </div>
        <div class="chip-group">
          <div class="chip active" id="chipStainless" onclick="toggleMaterial(this, 'stainless')">Stainless Steel</div>
          <div class="chip" id="chipGRP" onclick="toggleMaterial(this, 'grp')">GRP</div>
          <div class="chip" id="chipPVC" onclick="toggleMaterial(this, 'pvc')">PVC</div>
        </div>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">
          <span class="material-icons-outlined" style="font-size:16px">view_in_ar</span>
          Solution Type
        </div>
        <select class="form-input" id="solutionType" onchange="recalculate()" style="font-size:12px">
          <option value="skid">Skid-Mounted</option>
          <option value="container10">Containerised 10ft</option>
          <option value="container20">Containerised 20ft</option>
          <option value="container40">Containerised 40ft</option>
          <option value="bespoke">Bespoke</option>
        </select>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <h1 class="page-title">RO System Configuration</h1>
      <p class="page-subtitle">Automated system sizing and pricing based on feed water analysis</p>

      <!-- Key Metrics -->
      <div class="metrics-grid">
        <div class="metric-card">
          <div class="metric-label">Feed Flow</div>
          <div class="metric-value accent" id="metricFeedFlow">12.0</div>
          <div class="metric-sub">m³/hr</div>
        </div>
        <div class="metric-card">
          <div class="metric-label">Reject Flow</div>
          <div class="metric-value warning" id="metricRejectFlow">3.0</div>
          <div class="metric-sub">m³/hr</div>
        </div>
        <div class="metric-card">
          <div class="metric-label">Membranes</div>
          <div class="metric-value accent2" id="metricMembranes">9</div>
          <div class="metric-sub">8040 elements</div>
        </div>
        <div class="metric-card">
          <div class="metric-label">Pump Power</div>
          <div class="metric-value" id="metricPumpPower">7.5</div>
          <div class="metric-sub">kW</div>
        </div>
        <div class="metric-card">
          <div class="metric-label">Est. Permeate</div>
          <div class="metric-value success" id="metricPermeateQuality">1.08</div>
          <div class="metric-sub">µS/cm</div>
        </div>
      </div>

      <div class="content-grid">
        <!-- System Selection -->
        <div class="content-panel">
          <div class="panel-header">
            <div class="panel-title">
              <span class="material-icons-outlined">category</span>
              Recommended System
            </div>
            <span class="panel-badge" id="selectedModelBadge">MEMR09</span>
          </div>

          <div class="model-grid" id="modelGrid">
            <!-- Models populated by JS -->
          </div>

          <div style="margin-top:16px;padding:12px;background:var(--input-bg);border-radius:8px">
            <div class="calc-grid">
              <div class="calc-item">
                <span class="calc-label">Membrane Area (m²)</span>
                <span class="calc-value" id="calcMembraneArea">333</span>
              </div>
              <div class="calc-item">
                <span class="calc-label">Pressure Vessels</span>
                <span class="calc-value" id="calcPressureVessels">3</span>
              </div>
              <div class="calc-item">
                <span class="calc-label">Temp Correction</span>
                <span class="calc-value" id="calcTempCorrection">0.75</span>
              </div>
              <div class="calc-item">
                <span class="calc-label">Effective Flux</span>
                <span class="calc-value" id="calcEffectiveFlux">75%</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Alarms & Warnings -->
        <div class="content-panel">
          <div class="panel-header">
            <div class="panel-title">
              <span class="material-icons-outlined">notification_important</span>
              System Alerts
            </div>
            <span class="panel-badge" id="alarmCount">2 Active</span>
          </div>

          <div class="alarm-list" id="alarmList">
            <!-- Populated by JS -->
          </div>
        </div>

        <!-- Auto-Selected Components -->
        <div class="content-panel">
          <div class="panel-header">
            <div class="panel-title">
              <span class="material-icons-outlined">checklist</span>
              Selected Components
            </div>
          </div>

          <div class="component-list" id="componentList">
            <!-- Populated by JS -->
          </div>
        </div>

        <!-- Pricing Summary -->
        <div class="content-panel">
          <div class="panel-header">
            <div class="panel-title">
              <span class="material-icons-outlined">payments</span>
              Pricing Summary
            </div>
            <span class="panel-badge success" id="marginBadge">GM: 31%</span>
          </div>

          <table class="pricing-table">
            <thead>
              <tr>
                <th>Category</th>
                <th style="text-align:right">Cost (£)</th>
                <th style="text-align:right">Sell (£)</th>
              </tr>
            </thead>
            <tbody id="pricingBody">
              <!-- Populated by JS -->
            </tbody>
          </table>
        </div>

        <!-- ROI Analysis -->
        <div class="content-panel full-width">
          <div class="panel-header">
            <div class="panel-title">
              <span class="material-icons-outlined">trending_up</span>
              ROI Analysis
            </div>
            <span class="panel-badge">Customer Value</span>
          </div>

          <div class="roi-grid">
            <div class="roi-card">
              <div class="roi-value success" id="roiAnnualSavings">£63,000</div>
              <div class="roi-label">Annual Net Benefit</div>
            </div>
            <div class="roi-card">
              <div class="roi-value accent2" id="roiPayback">1.5</div>
              <div class="roi-label">Payback Period (Years)</div>
            </div>
            <div class="roi-card">
              <div class="roi-value accent" id="roi3Year">60%</div>
              <div class="roi-label">3-Year ROI</div>
            </div>
          </div>

          <div style="margin-top:16px;display:grid;grid-template-columns:1fr 1fr;gap:16px;font-size:12px">
            <div>
              <div style="color:var(--muted);margin-bottom:8px;font-weight:600">Annual Benefits</div>
              <div style="display:flex;justify-content:space-between;padding:4px 0;border-bottom:1px solid var(--line)">
                <span>Water Purchase Savings</span>
                <span style="color:var(--success)">£60,000</span>
              </div>
              <div style="display:flex;justify-content:space-between;padding:4px 0;border-bottom:1px solid var(--line)">
                <span>Wastewater Discharge Savings</span>
                <span style="color:var(--success)">£20,000</span>
              </div>
              <div style="display:flex;justify-content:space-between;padding:4px 0">
                <span>Production Efficiency</span>
                <span style="color:var(--success)">£3,000</span>
              </div>
            </div>
            <div>
              <div style="color:var(--muted);margin-bottom:8px;font-weight:600">Annual Costs (O&M)</div>
              <div style="display:flex;justify-content:space-between;padding:4px 0;border-bottom:1px solid var(--line)">
                <span>Electricity</span>
                <span style="color:var(--danger)">£10,000</span>
              </div>
              <div style="display:flex;justify-content:space-between;padding:4px 0;border-bottom:1px solid var(--line)">
                <span>Membranes & Chemicals</span>
                <span style="color:var(--danger)">£5,000</span>
              </div>
              <div style="display:flex;justify-content:space-between;padding:4px 0">
                <span>Maintenance Labor</span>
                <span style="color:var(--danger)">£5,000</span>
              </div>
            </div>
          </div>
        </div>

        <!-- ESG & Carbon Impact -->
        <div class="content-panel full-width">
          <div class="panel-header">
            <div class="panel-title">
              <span class="material-icons-outlined">eco</span>
              ESG & Carbon Impact
            </div>
            <span class="panel-badge">Sustainability</span>
          </div>

          <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:16px">
            <div style="padding:20px;background:linear-gradient(135deg,rgba(34,197,94,0.1),rgba(34,197,94,0.05));border-radius:12px;border:1px solid rgba(34,197,94,0.3);text-align:center">
              <div style="font-size:28px;font-weight:700;color:var(--success)" id="esgCarbonSavings">124</div>
              <div style="font-size:11px;color:var(--muted)">tCO₂e/yr avoided</div>
              <div style="font-size:10px;color:var(--success);margin-top:4px">Carbon Savings</div>
            </div>
            <div style="padding:20px;background:linear-gradient(135deg,rgba(59,130,246,0.1),rgba(59,130,246,0.05));border-radius:12px;border:1px solid rgba(59,130,246,0.3);text-align:center">
              <div style="font-size:28px;font-weight:700;color:#3b82f6" id="esgWaterRecovery">75%</div>
              <div style="font-size:11px;color:var(--muted)">water recovered</div>
              <div style="font-size:10px;color:#3b82f6;margin-top:4px">Water Recovery</div>
            </div>
            <div style="padding:20px;background:linear-gradient(135deg,rgba(168,85,247,0.1),rgba(168,85,247,0.05));border-radius:12px;border:1px solid rgba(168,85,247,0.3);text-align:center">
              <div style="font-size:28px;font-weight:700;color:#a855f7" id="esgEnergyEfficiency">2.9</div>
              <div style="font-size:11px;color:var(--muted)">kWh/m³</div>
              <div style="font-size:10px;color:#a855f7;margin-top:4px">Energy Efficiency</div>
            </div>
            <div style="padding:20px;background:linear-gradient(135deg,rgba(245,158,11,0.1),rgba(245,158,11,0.05));border-radius:12px;border:1px solid rgba(245,158,11,0.3);text-align:center">
              <div style="font-size:28px;font-weight:700;color:var(--warning)" id="esgScore">78</div>
              <div style="font-size:11px;color:var(--muted)">out of 100</div>
              <div style="font-size:10px;color:var(--warning);margin-top:4px">ESG Score</div>
            </div>
          </div>

          <div style="display:flex;flex-wrap:wrap;gap:8px">
            <div style="display:flex;align-items:center;gap:6px;padding:6px 12px;background:rgba(34,197,94,0.1);border-radius:20px;font-size:11px;color:var(--success)">
              <span class="material-icons-outlined" style="font-size:14px">check_circle</span>
              ISO 14001 Aligned
            </div>
            <div style="display:flex;align-items:center;gap:6px;padding:6px 12px;background:rgba(34,197,94,0.1);border-radius:20px;font-size:11px;color:var(--success)">
              <span class="material-icons-outlined" style="font-size:14px">check_circle</span>
              CDP Water Security
            </div>
            <div style="display:flex;align-items:center;gap:6px;padding:6px 12px;background:rgba(34,197,94,0.1);border-radius:20px;font-size:11px;color:var(--success)">
              <span class="material-icons-outlined" style="font-size:14px">check_circle</span>
              GRI Standards
            </div>
          </div>
        </div>
      </div>

      <!-- Action Bar -->
      <div class="action-bar">
        <button class="btn btn-secondary">
          <span class="material-icons-outlined" style="font-size:18px">save</span>
          Save Draft
        </button>
        <div style="display:flex;gap:12px">
          <button class="btn btn-secondary">
            <span class="material-icons-outlined" style="font-size:18px">picture_as_pdf</span>
            Export Quote
          </button>
          <button class="btn btn-success">
            <span class="material-icons-outlined" style="font-size:18px">send</span>
            Generate Proposal
          </button>
        </div>
      </div>
    </main>
  </div>

  <script>
    // Pricing Data from Excel (Packaged RO Estimator)
    const SYSTEM_MODELS = {
      '0.25': { model: 'MEMR0025', roCost: 1700, membranes: 1, power: null, cip: 3500, pipework: 3000, labour: 2000, shipping: 1000 },
      '0.5': { model: 'MEMR005', roCost: 2200, membranes: 2, power: null, cip: 3500, pipework: 4000, labour: 3000, shipping: 1000 },
      '1': { model: 'MEMR01', roCost: 3500, membranes: 4, power: null, cip: 3500, pipework: 5000, labour: 4000, shipping: 1000 },
      '1.5': { model: 'MEMR015', roCost: 4000, membranes: 5, power: null, cip: 3500, pipework: 6000, labour: 4000, shipping: 1000 },
      '2': { model: 'MEMR02', roCost: 4500, membranes: 2, power: 3, cip: 3500, pipework: 6000, labour: 5000, shipping: 1000 },
      '3': { model: 'MEMR03', roCost: 5000, membranes: 3, power: 4, cip: 3500, pipework: 7000, labour: 5000, shipping: 1000 },
      '4': { model: 'MEMR04', roCost: 5500, membranes: 4, power: 4, cip: 3500, pipework: 7000, labour: 6000, shipping: 1500 },
      '6': { model: 'MEMR06', roCost: 12100, membranes: 6, power: 7.5, cip: 3500, pipework: 8000, labour: 8000, shipping: 1500 },
      '9': { model: 'MEMR09', roCost: 15954, membranes: 9, power: 7.5, cip: 4716, pipework: 9000, labour: 10000, shipping: 1500 },
      '12': { model: 'MEMR012', roCost: 23250, membranes: 12, power: 11, cip: 4716, pipework: 10000, labour: 12000, shipping: 2500 },
      '16': { model: 'MEMR016', roCost: 27500, membranes: 16, power: 11, cip: 4716, pipework: 11000, labour: 15000, shipping: 2750 }
    };

    const COMPONENT_PRICES = {
      container10: 3000,
      container20: 5500,
      container40: 10500,
      uv: 2500,
      carbonFilter: 1062,
      ironRemoval: 3500,
      phDosing: 1400,
      antiscalantDosing: 1400,
      permeateFlushing: 700,
      boostPump: 2000,
      softener: 3000,
      secondStageRO: 8000,
      monitoring: 1500,
      // Technology Partners
      nxFiltration: 8500,
      atlantiumUV: 6500,
      bnovateMonitoring: 4500
    };

    const MATERIAL_MULTIPLIERS = {
      stainless: 1.0,
      grp: 0.85,
      pvc: 0.70
    };

    let selectedMaterial = 'stainless';

    const TEMP_CORRECTION = {
      5: 0.45, 10: 0.58, 15: 0.75, 20: 0.88, 25: 1.00, 30: 1.15, 35: 1.30
    };

    // Alarms from Excel
    const ALARM_CONDITIONS = [
      { check: (d) => d.temp < 15, type: 'warning', msg: 'Temperature is low - check this could affect flow. Perhaps increase size of system.' },
      { check: (d) => d.permeateQuality < 10, type: 'warning', msg: 'Conductivity below 10 µS/cm requires second stage RO system.' },
      { check: (d) => d.sdi > 6, type: 'critical', msg: 'SDI HIGH - Pre-treatment required; RO at risk of rapid fouling.' },
      { check: (d) => d.tds > 1000, type: 'warning', msg: 'TDS HIGH - May require high-rejection membranes and/or pre-treatment.' },
      { check: (d) => d.tss > 5, type: 'critical', msg: 'TSS HIGH - Full pre-treatment required (sand/multi-media + cartridge).' },
      { check: (d) => d.turbidity > 5, type: 'critical', msg: 'Turbidity HIGH - Must install pre-treatment (sand filter + cartridge filter).' },
      { check: (d) => d.pressure < 3, type: 'warning', msg: 'Pressure is too low - needs Boost pump.' },
      { check: (d) => d.iron > 0.3, type: 'critical', msg: 'Iron Levels HIGH - Dedicated iron removal system required.' },
      { check: (d) => d.iron > 0.1 && d.iron <= 0.3, type: 'warning', msg: 'Iron Levels elevated - Iron removal recommended.' },
      { check: (d) => d.ph < 5 || d.ph > 9, type: 'critical', msg: 'pH out of range - Risk of irreversible membrane damage.' },
      { check: (d) => d.chlorine > 0.05, type: 'warning', msg: 'Chlorine detected - Carbon filter + SMBS recommended.' },
      { check: (d) => d.hardness > 300, type: 'warning', msg: 'Very hard water - Softener or hardness removal recommended.' },
      { check: (d) => d.hardness >= 100 && d.hardness <= 300, type: 'info', msg: 'Hard water - Antiscalant dosing recommended.' }
    ];

    let currentData = {};
    let selectedComponents = [];

    function getInputData() {
      return {
        permeateFlow: parseFloat(document.getElementById('permeateFlow').value),
        permeateQuality: parseFloat(document.getElementById('permeateQuality').value),
        recovery: parseFloat(document.getElementById('recovery').value),
        markup: parseFloat(document.getElementById('markup').value),
        conductivity: parseFloat(document.getElementById('feedConductivity').value),
        tds: parseFloat(document.getElementById('feedTDS').value),
        pressure: parseFloat(document.getElementById('feedPressure').value),
        temp: parseFloat(document.getElementById('feedTemp').value),
        tss: parseFloat(document.getElementById('feedTSS').value),
        turbidity: parseFloat(document.getElementById('feedTurbidity').value),
        chlorine: parseFloat(document.getElementById('feedChlorine').value),
        sdi: parseFloat(document.getElementById('feedSDI').value),
        ph: parseFloat(document.getElementById('feedPH').value),
        iron: parseFloat(document.getElementById('feedIron').value),
        hardness: parseFloat(document.getElementById('feedHardness').value),
        containerRequired: document.getElementById('chipContainer').classList.contains('active'),
        uvRequired: document.getElementById('chipUV').classList.contains('active'),
        cipRequired: document.getElementById('chipCIP').classList.contains('active'),
        monitoringRequired: document.getElementById('chipMonitoring').classList.contains('active')
      };
    }

    function getTempCorrection(temp) {
      const temps = Object.keys(TEMP_CORRECTION).map(Number).sort((a,b) => a-b);
      for (let i = 0; i < temps.length; i++) {
        if (temp <= temps[i]) return TEMP_CORRECTION[temps[i]];
      }
      return 1.30;
    }

    function recalculate() {
      const data = getInputData();
      currentData = data;

      // Calculate flows
      const feedFlow = data.permeateFlow / (data.recovery / 100);
      const rejectFlow = feedFlow - data.permeateFlow;

      // Get system model
      const model = SYSTEM_MODELS[data.permeateFlow.toString()] || SYSTEM_MODELS['9'];

      // Calculations
      const membraneArea = model.membranes * 37;
      const pressureVessels = Math.ceil(model.membranes / 3);
      const tempCorrection = getTempCorrection(data.temp);
      const estimatedConductivity = data.conductivity * 0.02; // ~98% rejection

      // Update metrics
      document.getElementById('metricFeedFlow').textContent = feedFlow.toFixed(2);
      document.getElementById('metricRejectFlow').textContent = rejectFlow.toFixed(2);
      document.getElementById('metricMembranes').textContent = model.membranes;
      document.getElementById('metricPumpPower').textContent = model.power || '-';
      document.getElementById('metricPermeateQuality').textContent = estimatedConductivity.toFixed(2);

      // Update calculations
      document.getElementById('calcMembraneArea').textContent = membraneArea;
      document.getElementById('calcPressureVessels').textContent = pressureVessels;
      document.getElementById('calcTempCorrection').textContent = tempCorrection.toFixed(2);
      document.getElementById('calcEffectiveFlux').textContent = Math.round(tempCorrection * 100) + '%';

      // Update model selection
      document.getElementById('selectedModelBadge').textContent = model.model;
      renderModelGrid(data.permeateFlow.toString());

      // Check alarms
      renderAlarms(data);

      // Select components
      selectComponents(data, model);

      // Calculate pricing
      calculatePricing(data, model);
    }

    function renderModelGrid(selectedFlow) {
      const grid = document.getElementById('modelGrid');
      const flows = ['4', '6', '9', '12'];

      grid.innerHTML = flows.map(flow => {
        const m = SYSTEM_MODELS[flow];
        const isSelected = flow === selectedFlow;
        const isRecommended = flow === selectedFlow;

        return `
          <div class="model-card ${isSelected ? 'selected' : ''} ${isRecommended ? 'recommended' : ''}"
               onclick="selectModel('${flow}')">
            <div class="model-name">${m.model}</div>
            <div class="model-flow">${flow} m³/hr</div>
            <div class="model-price">£${m.roCost.toLocaleString()}</div>
          </div>
        `;
      }).join('');
    }

    function selectModel(flow) {
      document.getElementById('permeateFlow').value = flow;
      recalculate();
    }

    function renderAlarms(data) {
      const list = document.getElementById('alarmList');
      const activeAlarms = ALARM_CONDITIONS.filter(a => a.check(data));

      if (activeAlarms.length === 0) {
        list.innerHTML = `
          <div class="alarm-item success">
            <span class="material-icons-outlined">check_circle</span>
            <span>All parameters within acceptable range. System configuration validated.</span>
          </div>
        `;
        document.getElementById('alarmCount').textContent = 'All Clear';
        return;
      }

      list.innerHTML = activeAlarms.map(a => `
        <div class="alarm-item ${a.type}">
          <span class="material-icons-outlined">${a.type === 'critical' ? 'error' : a.type === 'warning' ? 'warning' : 'info'}</span>
          <span>${a.msg}</span>
        </div>
      `).join('');

      const criticalCount = activeAlarms.filter(a => a.type === 'critical').length;
      const warningCount = activeAlarms.filter(a => a.type === 'warning').length;
      document.getElementById('alarmCount').textContent = `${criticalCount} Critical, ${warningCount} Warning`;
    }

    function selectComponents(data, model) {
      selectedComponents = [];

      // Always include base RO system
      selectedComponents.push({ name: `RO System ${model.model}`, cost: model.roCost, type: 'base' });
      selectedComponents.push({ name: 'RO Membranes', cost: model.membranes * 460, type: 'base' });
      selectedComponents.push({ name: 'Pipework & Materials', cost: model.pipework, type: 'base' });
      selectedComponents.push({ name: 'Labour', cost: model.labour, type: 'base' });
      selectedComponents.push({ name: 'Shipping', cost: model.shipping, type: 'base' });

      // Auto-select based on water quality
      if (data.chlorine > 0.05) {
        selectedComponents.push({ name: 'Carbon Filter (Chlorine Removal)', cost: COMPONENT_PRICES.carbonFilter, type: 'auto', reason: 'Chlorine detected' });
      }
      if (data.iron > 0.1) {
        selectedComponents.push({ name: 'Iron Removal System', cost: COMPONENT_PRICES.ironRemoval, type: 'auto', reason: 'High iron' });
      }
      if (data.hardness >= 100 && data.hardness < 300) {
        selectedComponents.push({ name: 'Antiscalant Dosing', cost: COMPONENT_PRICES.antiscalantDosing, type: 'auto', reason: 'Hard water' });
      }
      if (data.hardness >= 300) {
        selectedComponents.push({ name: 'Water Softener', cost: COMPONENT_PRICES.softener, type: 'auto', reason: 'Very hard water' });
      }
      if (data.ph < 6 || data.ph > 8.5) {
        selectedComponents.push({ name: 'pH Adjustment Dosing', cost: COMPONENT_PRICES.phDosing, type: 'auto', reason: 'pH out of range' });
      }
      if (data.pressure < 3) {
        selectedComponents.push({ name: 'Boost Pump', cost: COMPONENT_PRICES.boostPump, type: 'auto', reason: 'Low pressure' });
      }
      if (data.permeateQuality < 10) {
        selectedComponents.push({ name: 'Second Stage RO', cost: COMPONENT_PRICES.secondStageRO, type: 'auto', reason: 'Ultra-pure water required' });
      }

      // Manual options
      if (data.containerRequired) {
        selectedComponents.push({ name: 'Container (20ft)', cost: COMPONENT_PRICES.container20, type: 'manual' });
      }
      if (data.uvRequired) {
        selectedComponents.push({ name: 'UV Disinfection System', cost: COMPONENT_PRICES.uv, type: 'manual' });
      }
      if (data.cipRequired) {
        selectedComponents.push({ name: 'CIP System', cost: model.cip, type: 'manual' });
      }
      if (data.monitoringRequired) {
        selectedComponents.push({ name: 'Remote Monitoring', cost: COMPONENT_PRICES.monitoring, type: 'manual' });
      }
      if (data.permeateFlow >= 6) {
        selectedComponents.push({ name: 'Permeate Flushing Unit', cost: COMPONENT_PRICES.permeateFlushing, type: 'base' });
      }

      // Technology Partners
      if (document.getElementById('chipNXFiltration')?.classList.contains('active')) {
        selectedComponents.push({ name: 'NX Filtration System', cost: COMPONENT_PRICES.nxFiltration, type: 'partner', reason: 'Advanced membrane separation' });
      }
      if (document.getElementById('chipAtlantiumUV')?.classList.contains('active')) {
        selectedComponents.push({ name: 'Atlantium Hydro-Optic UV', cost: COMPONENT_PRICES.atlantiumUV, type: 'partner', reason: 'Log4+ disinfection' });
      }
      if (document.getElementById('chipBNovate')?.classList.contains('active')) {
        selectedComponents.push({ name: 'bNovate Process Intelligence', cost: COMPONENT_PRICES.bnovateMonitoring, type: 'partner', reason: 'Real-time microbial detection' });
      }

      // Apply material multiplier
      const multiplier = MATERIAL_MULTIPLIERS[selectedMaterial] || 1.0;
      selectedComponents = selectedComponents.map(c => ({
        ...c,
        cost: Math.round(c.cost * multiplier)
      }));

      renderComponents();
      updateESGMetrics(data, selectedComponents);
    }

    function renderComponents() {
      const list = document.getElementById('componentList');
      list.innerHTML = selectedComponents.map(c => `
        <div class="component-item ${c.type}">
          <div class="component-name">
            ${c.name}
            ${c.type === 'auto' ? `<span class="component-tag auto">Auto</span>` : ''}
            ${c.type === 'partner' ? `<span class="component-tag" style="background:rgba(99,102,241,0.2);color:var(--accent)">Partner</span>` : ''}
            ${c.reason ? `<span style="font-size:10px;color:var(--muted);margin-left:8px">(${c.reason})</span>` : ''}
          </div>
          <div class="component-price">£${c.cost.toLocaleString()}</div>
        </div>
      `).join('');
    }

    function calculatePricing(data, model) {
      const markup = data.markup / 100;

      const baseCost = selectedComponents.reduce((sum, c) => sum + c.cost, 0);
      const workshop = baseCost * 0.05;
      const contingency = baseCost * 0.05;
      const socialImpact = baseCost * 0.02;
      const subtotal = baseCost + workshop + contingency + socialImpact;
      const sellPrice = subtotal * (1 + markup);
      const grossMargin = ((sellPrice - subtotal) / sellPrice * 100).toFixed(1);

      const body = document.getElementById('pricingBody');
      body.innerHTML = `
        <tr>
          <td>Base Manufacturing Cost</td>
          <td style="text-align:right">£${baseCost.toLocaleString()}</td>
          <td style="text-align:right">-</td>
        </tr>
        <tr>
          <td>Workshop Overhead (5%)</td>
          <td style="text-align:right">£${workshop.toLocaleString()}</td>
          <td style="text-align:right">-</td>
        </tr>
        <tr>
          <td>Contingency (5%)</td>
          <td style="text-align:right">£${contingency.toLocaleString()}</td>
          <td style="text-align:right">-</td>
        </tr>
        <tr>
          <td>Social Impact (2%)</td>
          <td style="text-align:right">£${socialImpact.toLocaleString()}</td>
          <td style="text-align:right">-</td>
        </tr>
        <tr class="total">
          <td>Total</td>
          <td style="text-align:right">£${subtotal.toLocaleString()}</td>
          <td style="text-align:right;color:var(--success)">£${Math.round(sellPrice).toLocaleString()}</td>
        </tr>
      `;

      document.getElementById('marginBadge').textContent = `GM: ${grossMargin}%`;

      // Update ROI
      const annualCosts = 20000;
      const annualBenefits = 83000;
      const annualNetBenefit = annualBenefits - annualCosts;
      const year1Cost = sellPrice + 12000 + 5000 + annualCosts; // system + install + training + ops
      const payback = sellPrice / annualNetBenefit;
      const threeYearROI = ((annualNetBenefit * 3 - sellPrice - 12000 - 5000) / (sellPrice + 12000 + 5000) * 100);

      document.getElementById('roiAnnualSavings').textContent = `£${annualNetBenefit.toLocaleString()}`;
      document.getElementById('roiPayback').textContent = payback.toFixed(1);
      document.getElementById('roi3Year').textContent = Math.round(threeYearROI) + '%';
    }

    function toggleChip(el) {
      el.classList.toggle('active');
      recalculate();
    }

    function toggleMaterial(el, material) {
      document.querySelectorAll('#chipStainless, #chipGRP, #chipPVC').forEach(c => c.classList.remove('active'));
      el.classList.add('active');
      selectedMaterial = material;
      recalculate();
    }

    function updateESGMetrics(data, selectedComponents) {
      // Calculate ESG metrics based on system configuration
      const recovery = data.recovery || 75;
      const flowRate = data.permeateFlow || 9;
      const opHours = 8000; // Assumed annual operating hours

      // Carbon savings: ~0.5 kg CO2e per m³ water treated (vs baseline)
      const annualWaterTreated = flowRate * opHours;
      const carbonSavings = Math.round((annualWaterTreated * 0.5) / 1000); // tonnes

      // Energy efficiency: base 3.5 kWh/m³, improved with better tech
      let energyEfficiency = 3.5;
      if (document.getElementById('chipNXFiltration')?.classList.contains('active')) energyEfficiency -= 0.3;
      if (document.getElementById('chipAtlantiumUV')?.classList.contains('active')) energyEfficiency -= 0.2;

      // ESG Score calculation
      let esgScore = 65;
      esgScore += Math.round(recovery / 5); // Up to +19 for 95% recovery
      if (document.getElementById('chipNXFiltration')?.classList.contains('active')) esgScore += 5;
      if (document.getElementById('chipAtlantiumUV')?.classList.contains('active')) esgScore += 4;
      if (document.getElementById('chipBNovate')?.classList.contains('active')) esgScore += 3;
      esgScore = Math.min(100, esgScore);

      document.getElementById('esgCarbonSavings').textContent = carbonSavings;
      document.getElementById('esgWaterRecovery').textContent = recovery + '%';
      document.getElementById('esgEnergyEfficiency').textContent = energyEfficiency.toFixed(1);
      document.getElementById('esgScore').textContent = esgScore;
    }

    function toggleTheme() {
      const body = document.body;
      const icon = document.getElementById('themeIcon');
      if (body.getAttribute('data-theme') === 'light') {
        body.removeAttribute('data-theme');
        icon.textContent = 'light_mode';
      } else {
        body.setAttribute('data-theme', 'light');
        icon.textContent = 'dark_mode';
      }
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      recalculate();
    });
  </script>
</body>
</html>
